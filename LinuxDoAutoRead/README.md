# Discourse 多线程自动阅读器

一个基于 DrissionPage 的多线程 Discourse 论坛自动阅读工具,支持 4 个线程并发阅读不同的未读帖子。

## 功能特点

- ✅ **多线程并发**: 4 个线程同时阅读 4 个不同的帖子,速度提升 4 倍
- ✅ **自动登录**: 自动登录到 Discourse 论坛
- ✅ **智能滚动**: 自动滚动页面直到内容完全加载
- ✅ **循环扫描**: 持续扫描并阅读所有未读帖子
- ✅ **统计信息**: 实时显示阅读进度和成功率
- 🔄 **Timing API**: 预留接口,可集成 timing API 快速标记已读

## 项目结构

```
autoread/
├── config.py              # 配置文件(登录信息、线程数等)
├── browser_manager.py     # 浏览器管理(初始化、登录、获取帖子)
├── post_reader.py         # 帖子阅读逻辑(滚动、API调用)
├── thread_coordinator.py  # 线程协调(任务队列、统计)
├── main.py               # 主程序入口
└── requirements.txt      # 依赖列表
```

## 安装依赖

```bash
pip install -r requirements.txt
```

## 配置

编辑 `config.py` 文件,修改以下配置:

```python
# 登录凭据
USERNAME = "your_username"
PASSWORD = "your_password"

# 线程数量(默认4)
NUM_THREADS = 4
```

## 使用方法

运行主程序:

```bash
python main.py
```

程序会:

1. 自动打开浏览器并创建 4 个标签页
2. 登录到论坛
3. 获取未读帖子列表
4. 使用 4 个线程并发阅读不同的帖子
5. 循环扫描直到所有帖子读完
6. 显示统计信息

## 工作原理

### 多线程架构

```
主线程
  ├─ 获取未读帖子列表
  ├─ 分发任务到队列
  └─ 等待任务完成

工作线程 (4个)
  ├─ 线程0: 使用标签页0读取帖子A
  ├─ 线程1: 使用标签页1读取帖子B
  ├─ 线程2: 使用标签页2读取帖子C
  └─ 线程3: 使用标签页3读取帖子D
```

### 阅读流程

1. **获取帖子**: 主线程访问 `/unseen` 页面获取未读帖子列表
2. **任务分发**: 将帖子 URL 添加到线程安全的任务队列
3. **并发阅读**: 4 个工作线程从队列取任务,各自独立阅读
4. **滚动加载**: 每个线程滚动页面直到内容完全加载
5. **标记已读**: Discourse 会自动标记滚动到底的帖子为已读
6. **循环扫描**: 完成一轮后重新获取未读列表,直到全部读完

## Timing API 集成(可选)

如果你抓包发现了 timing API,可以在 `post_reader.py` 中实现 `call_timing_api` 方法:

```python
def call_timing_api(tab, post_id, thread_id):
    # 实现API调用逻辑
    # 例如: POST /t/{topic_id}/timings
    pass
```

然后在 `read_post` 方法中优先调用 API,失败时降级到滚动方案。

## 注意事项

- 确保已安装 Chrome 浏览器
- 首次运行会自动配置 ChromeDriver
- 建议在网络稳定的环境下运行
- 可以通过 `config.py` 调整滚动速度和延迟参数

## 统计信息示例

```
==================================================
统计信息:
  总共阅读: 50 个帖子
  成功: 48 个
  失败: 2 个
  成功率: 96.0%
==================================================
```

## 许可证

MIT License
